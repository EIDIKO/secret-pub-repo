name: Read Template Properties

on:
  issues:
    types:
      - opened
jobs:
  read_template_properties:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Read Issue Template Properties
      id: extract-properties
      run: |
        issue_body="${{ github.event.issue.body }}"
        property_names=("NAME_OF_REPOSITORY" "PURPOSE_OF_REPOSITORY" "TEAM_OR_INDIVIDUAL_REQUSTIN" "PRIMARY_CONTACT" "REPOSITORY_DESCRIPTION" "ACCESS_AND_PERMISSION" "ACCESS_CONTROL" "BRANCHING_STRATEGY" "COLLABORATORS" "SECURITY_AND_COMPLIANCE" "ADDITIONAL_NOTES")
    
        declare -A property_values
        echo "==========================================="
        for property_name in "${property_names[@]}"; do
          echo "++++++++++++++++++++++++++++++++++++++++++"
          property_value=$(echo "$issue_body" | sed -n "/$property_name/,/## / p" | grep -v -E "^\[.*\]$" | sed -e "/$property_name/ s/^.*: *//")
          echo "$property_name"
          extracted_value=$(echo "$property_value" | sed -n 's/.*\[\(.*\)\].*/\1/p' | sed -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//')
          echo "$extracted_value"
          if [ "$property_name" == "NAME_OF_REPOSITORY" ]; then
            
            echo "::set-output name={NAME_OF_REPOSITORY}::{$property_name}"
            echo "::set-output name={NAME}::{VALUE}"
            echo "RNAME ${{ steps.extract-properties.outputs.NAME_OF_REPOSITORY }}"
            echo "RNAME ${{ steps.extract-properties.outputs.NAME }}"
          fi
          
          echo "++++++++++++++++++++++++++++++++++++++++++"
        done
    - name: Read Issue Template Properties
      id: extract-prope
      run: |
        echo "${{ steps.extract-properties.outputs.NAME_OF_REPOSITORY }}"
        echo "${{ steps.extract-properties.outputs.NAME }}"
        
